function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}var triggerError=attachErrorHandler("tooltipDebug",!0,(function(t){if("Script error."===t)return!0})),animatePopup=window._animatePopup,escaper=encodeURIComponent||escape,decoder=decodeURIComponent||unescape;function getParameterByName(t,o){t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp(t+"(=([^&;#]*)|&|#|$)").exec(o);return i?i[2]?decoder(i[2].replace(/\+/g," ")):"":null}function htmlEntities(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function htmlDecode(t){return $("<textarea/>").html(t).text()}var tooltip={loaded:!1,mapInterface:{parent:"",control:"",helper:""},map:null,tileSize:32,"interface":"",params:{},options:{},pinned:!1,clientViewX:0,clientViewY:0,padding:2,maxWidth:0,$docBody:null,$wrap:null,$content:null,$title:null,$body:null,mapOffsets:{x:0,y:0,w:0,h:0},screenProperties:{x:0,y:0},showDelay:100,showDelayInt:0,interrupt:!1,init:function(t,o,i,e){tooltip.screenProperties=t,tooltip.tileSize=parseInt(o),tooltip["interface"]=i;try{tooltip.mapInterface=$.parseJSON(e)}catch(p){return void triggerError("(init map) JSON parse error for: "+e+". "+p)}tooltip.maxWidth=parseInt(tooltip.$wrap.css("max-width"))},getMapControlFor:function(t){var o=tooltip.mapInterface.parent+".";switch(t){case"map":o+=tooltip.mapInterface.control;break;case"helper":o+=tooltip.mapInterface.helper}return o},removeDelays:function(){clearTimeout(tooltip.showDelayInt)},unInterrupt:function(){tooltip.interrupt=!1,tooltip.removeDelays()},setInterrupt:function(t){tooltip.interrupt="1"===t},hide:function(){tooltip.removeDelays(),animatePopup.stop(),window.location="?src="+window.tooltipRef+";action=hide;force=1"},log:function(t){window.location="?src="+window.tooltipRef+";action=log&msg="+escaper(t)},debugLog:function(t){window.tooltipDebug&&tooltip.log(t)},show:function(t,o,i,e){if(tooltip.interrupt)return tooltip.unInterrupt();(window.location="byond://winset?id="+tooltip["interface"]+";size="+t+"x"+o+";pos="+i+","+e+";alpha=255",tooltip.options.hasOwnProperty("transition")&&animatePopup.isValidAnimation(tooltip.options.transition)&&animatePopup.run(tooltip.options.transition,{logger:tooltip.log,"interface":tooltip["interface"],duration:500,complete:function(){tooltip.debugLog(tooltip.options.transition+" animation complete")}}),$(window).off("keypress").one("keypress",(function(t){$(t.target).is("input, textarea, select, option, button")||(window.location="byond://winset?"+tooltip.getMapControlFor("map")+".focus=true")})),tooltip.pinned)?($(".close-tip").show().off("click").one("click",(function(t){t.preventDefault(),tooltip.debugLog("tooltip hide called from click event"),tooltip.hide()})),$(window).off("click").on("click",(function(t){$(t.target).is("input, textarea, select, option, button")||(window.location="byond://winset?"+tooltip.getMapControlFor("map")+".focus=true")}))):tooltip.$content.off("mouseover").one("mouseover",(function(){tooltip.debugLog("tooltip hide called from mouseover event"),tooltip.hide()}))},position:function(t){if(_typeof(t)!==undefined&&t)try{tooltip.params=$.parseJSON(t)}catch(k){return void triggerError("(position params) JSON parse error for: "+t+". "+k)}var o=tooltip.map.viewSize.x,i=tooltip.map.viewSize.y,e=2*tooltip.clientViewX+1,p=2*tooltip.clientViewY+1,r=o/e,n=i/p,a=r/tooltip.tileSize,l=n/tooltip.tileSize,s=(tooltip.map.size.x-o)/2,c=(tooltip.map.size.y-i)/2,d=tooltip.params.cursor,f=parseInt(getParameterByName("icon-x",d)),u=parseInt(getParameterByName("icon-y",d)),m=getParameterByName("screen-loc",d);if(!f||!u||!m)return!1;if((m=m.split(",")).length<2)return!1;var g=m[0],w=m[1];if(!g||!w)return!1;m=g.split(":"),g=parseInt(m[0]);parseInt(m[1]);m=w.split(":"),w=parseInt(m[0]);parseInt(m[1]);tooltip.options.hasOwnProperty("special")&&"pod"===tooltip.options.special&&w--;var y=w;if(tooltip.options.hasOwnProperty("offset")){if(tooltip.options.offset.hasOwnProperty("x")){var h=parseInt(tooltip.options.offset.x);s+=h*a,tooltip.debugLog("Manually adjusted leftOffset by "+h+" amount. Real pixel offset value: "+h*a)}if(tooltip.options.offset.hasOwnProperty("y")){var v=parseInt(tooltip.options.offset.y);c+=v*l,tooltip.debugLog("Manually adjusted topOffset by "+v+" amount. Real pixel offset value: "+v*l)}}g=g<0?0:g>e?e:g,w=w<0?0:w>p?p:w;var b=Math.round((g-1)*r+s+tooltip.padding),x=Math.round((p-w+1)*n+c+tooltip.padding),I=0,S=0;if(tooltip.$wrap.attr("style",""),tooltip.options.hasOwnProperty("size")&&"string"==typeof tooltip.options.size){var O=tooltip.options.size.split("x"),P=O[0].toLowerCase(),z=O[1].toLowerCase();I="auto"===P?tooltip.$wrap.outerWidth():parseInt(O[0]),S="auto"===z?tooltip.$wrap.outerHeight():parseInt(O[1]),"auto"!==P&&tooltip.$wrap.css("min-width",I)}else I=tooltip.$wrap.outerWidth()+2,S=tooltip.$wrap.outerHeight();if(tooltip.$wrap.attr("style","width: "+I+"px; height: "+S+"px;"),tooltip.params.hasOwnProperty("flags")&&tooltip.params.flags.length>0){var C="bottom";if(-1!==$.inArray("top",tooltip.params.flags)&&(C="top",x=x-S-n-2*tooltip.padding),-1!==$.inArray("top2",tooltip.params.flags)&&(C="top",x=x-S-n-2*tooltip.padding,y<=1&&(x-=n)),-1!==$.inArray("right",tooltip.params.flags)&&(C="right",b+=r,x-=n),-1!==$.inArray("left",tooltip.params.flags)&&(C="left",b=b-I-2*tooltip.padding,x-=n),-1!==$.inArray("center",tooltip.params.flags))if("bottom"===C||"top"===C)(b=b+r/2-I/2)<tooltip.padding&&(b=tooltip.padding);else{var D=n-S;D>0&&(x+=D/2)}}b=b+tooltip.mapOffsets.x-tooltip.screenProperties.x,(x=x+tooltip.mapOffsets.y-tooltip.screenProperties.y)+S>tooltip.map.size.y+(tooltip.mapOffsets.y-tooltip.screenProperties.y)&&(x=x-S-n-tooltip.padding);var N=tooltip.map.size.x+(tooltip.mapOffsets.x-tooltip.screenProperties.x);b+I>N&&(b=b-(b+I-N)-2*tooltip.padding),tooltip.debugLog("Position called. Width: "+I+". Height: "+S+". PosX: "+b+". PosY: "+x),tooltip.show(I,S,b,x)},changeContent:function(t,o){t=htmlDecode(t),o=htmlDecode(o),tooltip.options.title=t,tooltip.options.content=o,tooltip.$content.empty(),void 0!==t&&(tooltip.$title=$("<h1>",{"class":"title",html:t}),tooltip.$content.append(tooltip.$title)),void 0!==o&&(tooltip.$body=$("<div>",{html:o}),tooltip.$content.append(tooltip.$body)),tooltip.showDelayInt=tooltip.$content.waitForImages((function(){tooltip.showDelayInt=setTimeout((function(){tooltip.position()}),tooltip.showDelay)}))},updateCallback:function(t){if(void 0===t||!t)return!1;tooltip.map={size:t[tooltip.getMapControlFor("helper")+".size"],viewSize:t[tooltip.getMapControlFor("map")+".view-size"]};try{tooltip.mapOffsets=$.parseJSON(t[tooltip.getMapControlFor("helper")+".saved-params"])}catch(o){return void triggerError("(updateCallback helper saved-params) JSON parse error for: "+t[tooltip.getMapControlFor("helper")+".saved-params"]+". "+o)}tooltip.debugLog("updateCallback called. map: "+JSON.stringify(t)+". params: "+JSON.stringify(tooltip.params)+". clientViewX: "+tooltip.clientViewX+". clientViewY: "+tooltip.clientViewY+". title: "+htmlEntities(tooltip.options.title)+". theme: "+tooltip.options.theme+". interrupt: "+tooltip.interrupt),window.location="byond://winset?id="+tooltip["interface"]+";pos="+tooltip.map.viewSize.x+",0;size=999x999;alpha=0",tooltip.$docBody.attr("class",tooltip.options.theme+(tooltip.pinned?" pinned":"")),tooltip.$wrap.attr("style",""),tooltip.changeContent(tooltip.options.title,tooltip.options.content)},update:function(t,o,i,e,p){try{tooltip.params=$.parseJSON(t)}catch(r){return void triggerError("(update params) JSON parse error for: "+t+". "+r)}tooltip.params.hasOwnProperty("init")&&tooltip.init(tooltip.params.init.screen,tooltip.params.init.iconSize,tooltip.params.init.window,tooltip.params.init.map);try{tooltip.options=$.parseJSON(o)}catch(r){return void triggerError("(update options) JSON parse error for: "+o+". "+r)}tooltip.removeDelays(),tooltip.interrupt=!1,tooltip.clientViewX=parseInt(i),tooltip.clientViewY=parseInt(e),tooltip.pinned="1"===p,window.location="byond://winget?callback="+tooltip["interface"]+":tooltip.updateCallback;id="+tooltip.getMapControlFor("map")+","+tooltip.getMapControlFor("helper")+";property=pos,size,view-size,saved-params"}};$(window).on("load",(function(){!1===tooltip.loaded&&(tooltip.loaded=!0,tooltip.debugLog("JS loaded, calling topic show"),window.location="?src="+window.tooltipRef+";action=show",tooltip.$docBody=$("body"),tooltip.$wrap=$("#wrap"),tooltip.$content=$("#content"))}));