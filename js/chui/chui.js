chui={minWidth:200,minHeight:200,flags:0};var escaper=encodeURIComponent||escape,decoder=decodeURIComponent||unescape,CHUI_FLAG_SIZABLE=1,CHUI_FLAG_MOVABLE=2,CHUI_FLAG_FADEIN=4,CHUI_FLAG_CLOSABLE=8;chui.setCookie=function(e,t,i){t=escaper(t);var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3);var n=e+"="+t+"; "+("expires="+o.toUTCString())+"; path=/";document.cookie=n},chui.getCookie=function(e){for(var t=e+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var n=i[o];" "==n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return decoder(n.substring(t.length,n.length))}return""},chui.setLabel=function(e,t){$("a").contents().filter((function(){return 3===this.nodeType}))[0].textContent=t},chui.bycall=function(e,t){(t=t||{})._cact=e;var i=new XMLHttpRequest;i.open("GET","?src="+chui.window+"&"+$.param(t)),i.send()},chui.close=function(){document.location="byond://winset?command="+escaper(".chui-close "+chui.window),chui.winset("is-visible","false")},chui.winset=function(e,t){document.location="byond://winset?"+chui.window+"."+e+"="+escape(t)},chui.winsets=function(e){document.location="byond://winset?id="+chui.window+"&"+$.param(e)},chui.setPos=function(e,t){chui.winset("pos",e+","+t)},chui.setSize=function(e,t){chui.winset("size",e+","+t)},chui.setPosSize=function(e,t,i,o){document.location="byond://winset?"+chui.window+".size="+escape(i+","+o)+"&"+chui.window+".pos="+escape(e+","+t)},chui.chatDebug=function(e){document.location="byond://winset?command="+escaper(".output browseroutput:output "+escaper(e))},chui.initialize=function(){chui.data={},$("meta").each((function(){var e=$(this).attr("name");e&&(chui.data[e]=$(this).attr("value"))})),chui.window=chui.data.ref,chui.flags=Number(chui.data.flags),$("#content").nanoScroller({scrollTop:window.name}),chui.winset("transparent-color","#FF00E4");var e=window.screenLeft,t=window.screenTop,i=chui.getCookie("chuiOffset");if(i){var o=$.parseJSON(i);chui.offsetX=o.offsetX,chui.offsetY=o.offsetY}chui.setPos(0,0),chui.offsetX=window.screenLeft,chui.offsetY=window.screenTop;var n=e-chui.offsetX,c=t-chui.offsetY;if(n=n<chui.offsetX?0:n,c=c<chui.offsetY?0:c,!i){var s={offsetX:chui.offsetX,offsetY:chui.offsetY};chui.setCookie("chuiOffset",JSON.stringify(s),.333)}chui.setPos(n,c),$("body").on("mousemove","#titlebar",(function(e){if(e=e||window.event,"undefined"==typeof chui.lastX&&(chui.lastX=e.screenX,chui.lastY=e.clientY),1==chui.titlebarMousedown){var t=e.screenX-chui.lastX,i=e.screenY-chui.lastY;t+=window.screenLeft-chui.offsetX,i+=window.screenTop-chui.offsetY,chui.setPos(t,i)}chui.lastX=e.screenX,chui.lastY=e.screenY})),$("body").on("mousedown","#titlebar",(function(){chui.titlebarMousedown=1,$(this)[0].setCapture&&$(this)[0].setCapture()})),$("body").on("mouseup","#titlebar",(function(){chui.titlebarMousedown=0,$(this)[0].releaseCapture&&$(this)[0].releaseCapture()})),chui.flags&CHUI_FLAG_SIZABLE>0?($("body").on("mousemove","div.resizeArea",(function(e){if(!chui.resizeWorking){if(chui.resizeWorking=!0,e=e||window.event,"undefined"==typeof chui.lastX&&(chui.lastX=e.screenX-chui.offsetX,chui.lastY=e.screenY-chui.offsetY),1==chui.resizeMousedown){var t=document.body.offsetWidth,i=document.body.offsetHeight,o=Number($(this).attr("rx")),n=Number($(this).attr("ry")),c=e.screenX-chui.offsetX-chui.lastX,s=e.screenY-chui.offsetY-chui.lastY,u=window.screenLeft-chui.offsetX,a=window.screenTop-chui.offsetY,r=t+c*o;-1==o&&(u+=c);var h=i+s*n;-1==n&&(a+=s),r=Math.max(chui.minWidth,r),h=Math.max(chui.minHeight,h),chui.setPosSize(u,a,r,h)}chui.lastX=e.screenX-chui.offsetX,chui.lastY=e.screenY-chui.offsetY,chui.resizeWorking=!1}})),$("body").on("mousedown","div.resizeArea",(function(){chui.resizeMousedown=1,this.setCapture&&this.setCapture()})),$("body").on("mouseup","div.resizeArea",(function(){chui.resizeMousedown=0,this.releaseCapture&&this.releaseCapture()}))):$("div.resizeArea").remove(),$("body").on("click","a.button",(function(){var e=null;try{e=this.dataset.info}catch(t){e=this.getAttribute("data-info")}chui.bycall("click",{id:this.id,data:e})})),$(".close").click((function(){chui.flags&CHUI_FLAG_FADEIN?chui.fadeOut():chui.close()})),$(".close").attr("href","#"),chui.bycall("register"),chui.flags&CHUI_FLAG_FADEIN&&chui.fadeIn(),chui.data.needstitle&&$("#windowtitle").text($("title").text()||" ")},chui.fadeIn=function(){var e=document.body.offsetWidth,t=document.body.offsetHeight,i=window.screenLeft-chui.offsetX,o=window.screenTop-chui.offsetY;chui.setSize(e+80,t+80),chui.setPos(i-40,o-40),chui.winset("alpha","0"),setTimeout((function(){$({foo:0}).animate({foo:1},{duration:1e3,step:function(n){var c=1-n;chui.winsets({alpha:255*n,size:e+80*c+","+(t+80*c),pos:i-40*c+","+(o-40*c)})}})}),1e3)},chui.fadeOut=function(){var e=document.body.offsetWidth,t=document.body.offsetHeight,i=window.screenLeft-chui.offsetX,o=window.screenTop-chui.offsetY;$({foo:1}).animate({foo:0},{duration:1e3,step:function(n){var c=1-n;chui.winsets({alpha:255*n,size:e+80*c+","+(t+80*c),pos:i-40*c+","+(o-40*c)})},complete:chui.close})},chui.templateSet=function(e,t){var i=document.getElementById("chui-tmpl-"+e);i&&(i.innerText=t)},chui.templateBulk=function(e){var t=JSON.parse(e);if(t)for(var i in t){var o=document.getElementById("chui-tmpl-"+i);o&&(o.innerText=t[i])}};var activeRequests=[],reqID=0;function updateScroll(){window.name=$("#content")[0].nanoscroller.contentScrollTop}chui.request=function(e,t,i){activeRequests.push({id:++reqID,callback:i}),t._id=reqID,t._path=e,chui.bycall("request",t)},window.addEventListener("beforeunload",updateScroll),window.addEventListener("scroll",updateScroll),$(chui.initialize);